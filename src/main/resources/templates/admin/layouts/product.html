<!doctype html>
<html class="no-js" lang="" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{admin/main-layout.html :: layout (~{::title}, ~{::#layout})}">

<head>
	<title>Quản lý sản phẩm</title>
</head>

<body>
	<section id="layout" ng-controller="productCtrl">
		<div class="wizard-area">
			<div class="container">
				<div class="row header-filter-product header-action-product">
					<div class="filter-search col-md-6">
						<div class="input-group">
							<input type="text" class="form-control" placeholder="Tìm kiếm nhiều sản phẩm..." ng-model="searchText">

							<span class="input-group-btn">
								<button class="btn btn-default" type="button"><span
										class="glyphicon glyphicon-search"></span></button>
							</span>
						</div>
					</div>
					<div class="action-product col-md-6">
						<div class="dropdown">
							<button class="btn btn-success dropdown-toggle" type="button" id="submenuDropdown"
								data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								Thêm mới
								<span class="caret"></span>
							</button>
							<button type="button" class="btn btn-primary" data-toggle="modal"
								data-target="#historyPriceModal">Lịch sử giá</button>
							<ul class="dropdown-menu submenu" aria-labelledby="submenuDropdown">
								<li><button type="button" class="btn btn-primary" data-toggle="modal"
										data-target="#productModal">Thêm sản phẩm</button></li>
								<li><button type="button" class="btn btn-success" data-toggle="modal"
										data-target="#sizeModal">Tạo kích thước</button></li>
								<li><button type="button" class="btn btn-info" data-toggle="modal"
										data-target="#materialModal">Thêm chất liệu</button></li>
							</ul>
						</div>
						<button class="btn btn-success" ng-click="exportToExcel()">Xuất Excel</button>

					</div>
				</div>
				<div class="row">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<table class="table table-striped"  >
							<thead>
								<tr class="table-bordered custom-border tr-thead white-links">
									<th class="text-center"><a ng-click="orderByField = 'id'; reverseSort = !reverseSort"># <i class="fas fa-sort"></i></a></th>
									
									<th class="text-center" colspan="2"><a  ng-click="orderByField = 'name'; reverseSort = !reverseSort">Sản Phẩm <i class="fas fa-sort"></i></a></th>
									<th class="text-center"><a  ng-click="orderByField = 'price'; reverseSort = !reverseSort">Giá Sản Phẩm VNĐ <i class="fas fa-sort"></i></th>
										<th><a  ng-click="orderByField = 'quantity'; reverseSort = !reverseSort">Số Lượng <i class="fas fa-sort"></i></th>
									<th>Trạng Thái</th>
									<th>Chất Liệu</th>
									<th><a  ng-click="orderByField = 'size'; reverseSort = !reverseSort">Kích Thước <i class="fas fa-sort"></i></th>
									<th class="text-center">Mô Tả</th>
								</tr>
							</thead>
							<tbody ng-repeat="item in filterItems() | orderBy: orderByField:reverseSort ">
								<tr data-toggle="collapse" data-target="#{{$index + 1}}" class="tr-title-product"
									ng-click="Edit(item.id, $index)">

									<td>{{$index + 1}}</td>
									<td><img class="object-fit"
										ng-src="/images/{{item.image}}" 
										name="image" style="max-height: 50px; width: 80%;">
									</td>
										<td>{{item.name}}</td>
										<td>{{ item.price | currency : '' : 0 }} VND</td>
									<td>{{item.quantity}} cái</td>
									<td>{{item.status ? 'Kinh Doanh' : 'Ngừng Kinh doanh'}}</td>
									<td>{{item.material.material}}</td>
									<td>{{item.size.size}}</td>
									<td>{{item.description}}</td>

								</tr>
								<tr id="{{$index + 1}}" class="collapse" ng-if="$index === selectedItemIndex">
									<td colspan="10" class="product-info border-1">
										<h4>Thông tin sản phẩm</h4>
										<form enctype="multipart/form-data">
											<div class="row">
												<div class="col-md-4">
													<div class="form-group"
														style="border: 1px solid rgb(221, 218, 218); height: 250px;">
														<div class="nk-int-st image-container">
															<img class="object-fit" id="uploadedImages"
																ng-src="/images/{{form.image}}" alt="Uploaded Image"
																name="image" style="max-height: 250px; width: 100%;">
														</div>
													</div>
													<div class="form-group">
														<label for="fileInput" class="fw-bold">Chọn Hình</label>
														<div class="input-group">
															<input style="object-fit: contain;" type="file"
																class="form-control" ng-model="form.image"
																accept=".png, .jpg, .jpeg, .gif" id="fileInput22"
																onchange="displayImages(event)">
														</div>
													</div>

												</div>
												<div class="col-md-8">
													<div class="row">
														<div class="col-md-6">
															<div class="form-group">
																<label for="name" class="fw-bold">Mã Sản Phẩm</label>
																<input type="text" class="form-control border-bottom"
																	id="id" ng-model="form.id" disabled>
															</div>
															<div class="form-group mt-3">
																<label for="name" class="fw-bold">Tên Sản Phẩm</label>
																<input type="text" class="form-control border-bottom"
																	id="name" ng-model="form.name">
																	
															</div>
															<div class="form-group mt-3">
																<label for="price" class="fw-bold">Giá Sản Phẩm</label>
																<input type="text" class="form-control border-bottom"
																	id="price" ng-model="form.price">
																	<small class="text-danger">{{ errorMessages.price }}</small>
										
															</div>
															<div class="form-group">
																<label for="quantity" class="fw-bold">Số Lượng</label>
																<input type="number" min="1" value="1"
																	class="form-control text-center border-bottom"
																	id="quantity" placeholder="Số Lượng"
																	ng-model="form.quantity">
																	<small class="text-danger">{{ errorMessages.quantity }}</small>
															</div>


														</div>
														<div class="col-md-6">
															<div class="form-group mt-3">
																<label class="fw-bold">Trạng thái</label>
																<div class="radio">
																	<label>
																		<input type="radio" name="status" value="true"
																			ng-model="form.status"
																			ng-checked="form.status" ng-value="true">
																		Kinh doanh
																	</label>
																	<label>
																		<input type="radio" name="status" value="false"
																			ng-model="form.status"
																			ng-checked="form.status" ng-value="false">
																		Ngừng Kinh doanh
																	</label>
														
																</div>
															</div>
															<div class="form-group mt-3">
																<label for="size" class="fw-bold">Chọn Kích
																	Thước</label>
																<select class="form-control border-bottom" id="size"
																	ng-model="form.size"
																	ng-options="size as size.size for size in sizes track by size.id">
																	<option value="">Chọn Kích Thước</option>
																</select>
															</div>

															<div class="form-group mt-3">
																<label for="material" class="fw-bold">Chất Liệu</label>
																<select class="form-control border-bottom" id="material"
																	ng-model="form.material"
																	ng-options="material as material.material for material in materials track by material.id">
																	<option value="">Chọn Chất Liệu</option>
																</select>
															</div>


															<div class="form-group mt-3">
																<label for="description" class="fw-bold">Mô Tả</label>
																<textarea class="form-control border-bottom" rows="1"
																	id="description"
																	ng-model="form.description"></textarea>
															</div>
														</div>
													</div>
												</div>
												<div class="col-md-12 text-right mt-5">
													<div class="btn-group ib-btn-gp active-hook nk-email-inbox">
														<button class="btn btn-primary notika-btn-primary waves-effect"
															ng-click="Update(form.id)">
															<i class="fa fa-save"></i> Lưu
														</button>
														<button class="btn btn-danger notika-btn-danger waves-effect"
															ng-click="Delete(form.id)">
															<i class="fa fa-trash"></i> Xóa
														</button>
													</div>
												</div>
											</div>
										</form>

									</td>
								</tr>
								<!-- Thêm các dòng sản phẩm khác tương tự ở đây -->
							</tbody>
						</table>
					</div>	
				</div>
				<div class="text-center">
					<nav aria-label="Page navigation">
					  <ul class="pagination justify-content-center">
						<li ng-if="pagination.currentPage > 1" class="page-item">
						  <button ng-click="goToPage(1)" class="page-link btn btn-info">Trang đầu</button>
						</li>
						<li ng-if="pagination.currentPage > 1" class="page-item">
						  <button ng-click="prevPage()" class="page-link btn btn-info">Trước</button>
						</li>
				  
						<li ng-repeat="pageNumber in pagination.pageNumbers" class="page-item">
						  <button ng-click="goToPage(pageNumber)" class="page-link btn btn-info">{{ pageNumber }}</button>
						</li>
						
						<li ng-if="pagination.currentPage < pagination.totalPages" class="page-item">
						  <button ng-click="nextPage()" class="page-link btn btn-info">Tiếp</button>
						</li>
						<li ng-if="pagination.currentPage < pagination.totalPages" class="page-item">
						  <button ng-click="goToPage(pagination.totalPages)" class="page-link btn btn-info">Trang cuối</button>
						</li>
					  </ul>
					</nav>
				  </div>
				  
			</div>
		</div>
		<!-- The Modal thêm sản phẩm -->
		<div class="modal fade" id="productModal">
			<div class="modal-dialog modal-dialog-centered modal-lg">
				<div class="modal-content">
					<!-- Modal Header -->
					<div class="modal-header">
						<h4 class="modal-title">Thêm sản phẩm</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>

					<!-- Modal body -->
					<div class="modal-body">
						<form enctype="multipart/form-data">
							<div class="row">
								<div class="col-md-4">
									<div class="form-group"
										style="border: 1px solid rgb(221, 218, 218); height: 250px;">
										<div class="nk-int-st image-container">
											<img class="object-fit" id="uploadedImage" src="#" alt="Uploaded Image"
												style="display: none; max-height: 250px; width: 100%;">
										</div>
									</div>
									<div class="form-group">
										<label for="fileInput" class="fw-bold">Chọn Hình</label>
										<div class="input-group">
											<input style="object-fit: contain;" type="file" name="image"
												ng-model="image" class="form-control" accept=".png, .jpg, .jpeg, .gif"
												id="fileInputCreateProduct" onchange="displayImage(event)">
											
										</div>
									</div>

								</div>
								<div class="col-md-8">
									<div class="row">
										<div class="col-md-6">
											<div class="form-group">
												<input type="hidden" class="form-control border-bottom" id="id"
													ng-model="id" name="id">
											</div>
											<div class="form-group mt-3">
												<label for="Name" class="fw-bold">Tên Sản Phẩm(*)</label>
												<input type="text" class="form-control border-bottom" id="name"
													ng-model="name" name="name" >
													<small class="text-danger">{{ errorMessages.name }}</small>
										
											</div>
											<div class="form-group mt-3">
												<label for="price" class="fw-bold">Giá Sản Phẩm(*)</label>
												<input type="text" class="form-control border-bottom" id="price"
													ng-model="price" name="price" >
													<small class="text-danger">{{ errorMessages.price }}</small>
										
											</div>
											<div class="form-group mt-3">
												<label class="fw-bold">Trạng Thái(*)</label>
												<div class="radio">
													<label>
														<input type="radio" name="status" value="false"
															ng-model="status" ng-checked="status" ng-value="false">
														Ngừng kinh doanh
													</label>
													<label>
														<input type="radio" name="status" value="true" ng-model="status"
															ng-checked="status" ng-value="true">
														Kinh doanh
													</label>
													<small class="text-danger">{{ errorMessages.status }}</small>
										
												</div>
											</div>

										</div>
										<div class="col-md-6">
											<div class="form-group">
												<label for="quantity" class="fw-bold">Số Lượng(*)</label>
												<input type="number" min="1" value="1"
													class="form-control text-center border-bottom" id="quantity"
													placeholder="Số Lượng" ng-model="quantity" name="quantity" >
													<small class="text-danger">{{ errorMessages.quantity }}</small>
										
											</div>

											<div class="form-group mt-3">
												<label for="size" class="fw-bold">Chọn Kích Thước</label>
												<select class="form-control border-bottom" id="size" ng-model="size"
													ng-options="size as size.size for size in sizes track by size.id">
													<option value="">Chọn Kích Thước</option>
												
												</select>
											</div>

											<div class="form-group mt-3">
												<label for="material" class="fw-bold">Chất Liệu</label>
												<select class="form-control border-bottom" id="material"
													ng-model="material"
													ng-options="material as material.material for material in materials track by material.id">
													<option value="">Chọn Chất Liệu</option>
													
												</select>
											</div>


											<div class="form-group mt-3">
												<label for="description" class="fw-bold">Mô Tả</label>
												<textarea class="form-control border-bottom" rows="1" id="description"
													ng-model="description" name="description" required></textarea>
											</div>
										</div>
									</div>

								</div>
							</div>
						</form>
					</div>

					<!-- Modal footer -->
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" ng-click="Create()"
							><i class="fa fa-save"></i> Thêm</button>
						<button type="button" class="btn btn-info"><i class="fa fa-rotate-right"></i> Làm mới</button>
					</div>
				</div>
			</div>
		</div>


		<!-- The Modal Tạo kích thước  -->
		<div class="modal fade" id="sizeModal" ng-controller="sizeCtrl">
			<div class="modal-dialog modal-dialog-centered modal-md">
				<div class="modal-content">
					<!-- Modal Header -->
					<div class="modal-header">
						<h4 class="modal-title">Tạo kích thước</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>

					<!-- Modal body -->
					<div class="modal-body">
						<form name="formSize">
							<div class="row">
								<div class="col-md-4">
									<div class="form-group">
										<label for="height" class="fw-bold">Chiều cao</label>
										<input type="number" min="49" class="form-control border-bottom" id="height" max="300"
											name="height" placeholder="Nhập chiều cao" ng-model="height" required>
									</div>
								</div>
								<div class="col-md-4">
									<div class="form-group">
										<label for="width" class="fw-bold">Chiều rộng</label>
										<input type="number" min="49" class="form-control border-bottom" id="width" max="300"
											name="width" placeholder="Nhập chiều rộng" ng-model="width" required>
									</div>
								</div>
								<div class="col-md-4">
									<div class="form-group">
										<label for="length" class="fw-bold">Chiều dài</label>
										<input type="number" min="49" class="form-control border-bottom" id="length" max="300"
											name="length" placeholder="Nhập chiều dài" ng-model="length" required>
									</div>
								</div>
							</div>
						</form>
					</div>

					<!-- Modal footer -->
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" ng-click="createSize()" ng-disabled="formSize.$invalid"><i class="fa fa-save"></i>
							Lưu</button>
						<button type="button" class="btn btn-info" data-dismiss="modal"><i class="fa fa-times"></i>
							Hủy</button>
					</div>
				</div>
			</div>
		</div>


		<!-- The Modal Thêm chất liệu -->
		<div class="modal fade" id="materialModal" ng-controller="materialCtrl">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<!-- Modal Header -->
					<div class="modal-header">
						<h4 class="modal-title">Thêm chất liệu</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>

					<!-- Modal body -->
					<div class="modal-body">
						<form name="formMaterial">
							<div class="form-group">
								<input type="hidden" class="form-control border-bottom" id="id" ng-model="id" name="id"
									>
								<label for="material" class="fw-bold">Chất Liệu</label>
								<input type="text" class="form-control border-bottom" id="material" placeholder="Nhập chất liệu. VD: Cao su"
									ng-model="material" name="material" required >
							</div>
						</form>
					</div>

					<!-- Modal footer -->
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" ng-disabled="formMaterial.$invalid" ng-click="createMaterial()">Lưu</button>
						<button type="button" class="btn btn-info" data-dismiss="modal">Hủy</button>
					</div>
				</div>
			</div>
		</div>


		<!-- The Modal -->
		<div class="modal fade" id="historyPriceModal" ng-controller="priceHistoryCtrl">
			<!-- Modal content -->
			<div class="modal-dialog modal-dialog-centered modal-lg">
				<div class="row">
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<table class="table table-striped">
							<thead>
								<tr class="table-bordered custom-border tr-thead white-links">
								
									<th class="text-center"><a  ng-click="orderByField = 'id'; reverseSort = !reverseSort"># <i class="fas fa-sort"></i></a></th>
									<th class="text-center"><a  ng-click="orderByField = 'product.name'; reverseSort = !reverseSort">Tên sản phẩm <i class="fas fa-sort"></i></a></th>
									<th class="text-center"><a  ng-click="orderByField = 'price'; reverseSort = !reverseSort">Giá cũ <i class="fas fa-sort"></i></a></th>
									<th class="text-center"><a  ng-click="orderByField = 'product.price'; reverseSort = !reverseSort">Giá mới <i class="fas fa-sort"></i></a></th>
									<th class="text-center"><a  ng-click="orderByField = 'changeDate'; reverseSort = !reverseSort">Ngày <i class="fas fa-sort"></i></a></th>
									<th>Ảnh</th>

								</tr>
							</thead>
							<tbody ng-repeat="priceHistory in priceHistorys | orderBy: orderByField:reverseSort">
								<tr data-toggle="collapse" data-target="#{{$index + 1}}" class="tr-title-priceHistory">
									<td class="text-center">{{$index + 1}}</td>
									<td>{{priceHistory.product.name}}</td>
									<td>{{priceHistory.price | currency : '' : 0 }} VNĐ</td>
									<td>{{priceHistory.product.price | currency : '' : 0 }} VNĐ</td>
									<td>{{priceHistory.changeDate | date:'HH:mm dd-MM-yyyy'}}</td>
									<td>
										<img class="object-fit" ng-src="/images/{{priceHistory.product.image}}"
											alt="Uploaded Image" name="product" style="max-height: 100px; width: 100%;">
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					
				</div>
			</div>
		</div>


	</section>
</body>


</html>